---
title: Prise en charge des appels d’API externes dans Scripts Office
description: Support et conseils pour faire des appels API externes dans un script Office.
ms.date: 05/17/2021
localization_priority: Normal
ms.openlocfilehash: fd6ba0c57bf4cabb2d07421355cacff373f6706c
ms.sourcegitcommit: 4687693f02fc90a57ba30c461f35046e02e6f5fb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/19/2021
ms.locfileid: "52545081"
---
# <a name="external-api-call-support-in-office-scripts"></a><span data-ttu-id="837c7-103">Prise en charge des appels d’API externes dans Scripts Office</span><span class="sxs-lookup"><span data-stu-id="837c7-103">External API call support in Office Scripts</span></span>

<span data-ttu-id="837c7-104">Les auteurs de scripts ne devraient pas s’attendre à un comportement cohérent lors de [l’utilisation d’API](https://developer.mozilla.org/docs/Web/API) externes pendant la phase d’aperçu de la plate-forme.</span><span class="sxs-lookup"><span data-stu-id="837c7-104">Script authors shouldn't expect consistent behavior when using [external APIs](https://developer.mozilla.org/docs/Web/API) during the platform's preview phase.</span></span> <span data-ttu-id="837c7-105">En tant que tel, ne vous fiez pas aux API externes pour les scénarios de script critiques.</span><span class="sxs-lookup"><span data-stu-id="837c7-105">As such, do not rely on external APIs for critical script scenarios.</span></span>

<span data-ttu-id="837c7-106">Les appels vers des API externes ne peuvent être effectués que par le biais de l’application Excel, et non par le biais Power Automate [dans des circonstances normales.](#external-calls-from-power-automate)</span><span class="sxs-lookup"><span data-stu-id="837c7-106">Calls to external APIs can be only be made through the Excel application, not through Power Automate [under normal circumstances](#external-calls-from-power-automate).</span></span>

> [!CAUTION]
> <span data-ttu-id="837c7-107">Les appels externes peuvent entraîner l’exposition de données sensibles à des points de terminaison indésirables.</span><span class="sxs-lookup"><span data-stu-id="837c7-107">External calls may result in sensitive data being exposed to undesirable endpoints.</span></span> <span data-ttu-id="837c7-108">Votre administrateur peut établir une protection pare-feu contre de tels appels.</span><span class="sxs-lookup"><span data-stu-id="837c7-108">Your admin can establish firewall protection against such calls.</span></span>

## <a name="configure-your-script-for-external-calls"></a><span data-ttu-id="837c7-109">Configurez votre script pour des appels externes</span><span class="sxs-lookup"><span data-stu-id="837c7-109">Configure your script for external calls</span></span>

<span data-ttu-id="837c7-110">Les appels externes [sont asynchrones et](https://developer.mozilla.org/docs/Learn/JavaScript/Asynchronous/Async_await) exigent que votre script soit marqué comme `async` .</span><span class="sxs-lookup"><span data-stu-id="837c7-110">External calls are [asynchronous](https://developer.mozilla.org/docs/Learn/JavaScript/Asynchronous/Async_await) and require that your script is marked as `async`.</span></span> <span data-ttu-id="837c7-111">Ajoutez le `async` préfixe à votre `main` fonction et qu’il retourne un `Promise` , comme indiqué ici:</span><span class="sxs-lookup"><span data-stu-id="837c7-111">Add the `async` prefix to your `main` function and have it return a `Promise`, as shown here:</span></span>

```typescript
async function main(workbook: ExcelScript.Workbook) : Promise <void>
```

> [!NOTE]
> <span data-ttu-id="837c7-112">Les scripts qui retournent d’autres informations peuvent renvoyer `Promise` un de ce type.</span><span class="sxs-lookup"><span data-stu-id="837c7-112">Scripts that return other information can return a `Promise` of that type.</span></span> <span data-ttu-id="837c7-113">Par exemple, si votre script doit retourner un `Employee` objet, la signature de retour serait `: Promise <Employee>`</span><span class="sxs-lookup"><span data-stu-id="837c7-113">For example, if your script needs to return an `Employee` object, the return signature would be `: Promise <Employee>`</span></span>

<span data-ttu-id="837c7-114">Vous devrez apprendre les interfaces du service externe pour passer des appels vers ce service.</span><span class="sxs-lookup"><span data-stu-id="837c7-114">You'll need to learn the external service's interfaces to make calls to that service.</span></span> <span data-ttu-id="837c7-115">Si vous utilisez ou `fetch` [REST API](https://wikipedia.org/wiki/Representational_state_transfer), vous devez déterminer la structure JSON des données retournées.</span><span class="sxs-lookup"><span data-stu-id="837c7-115">If you are using `fetch` or [REST APIs](https://wikipedia.org/wiki/Representational_state_transfer), you need to determine the JSON structure of the returned data.</span></span> <span data-ttu-id="837c7-116">Pour les entrées et les sorties de votre script, envisagez de faire `interface` un pour correspondre aux structures JSON nécessaires.</span><span class="sxs-lookup"><span data-stu-id="837c7-116">For both input to and output from your script, consider making an `interface` to match the needed JSON structures.</span></span> <span data-ttu-id="837c7-117">Cela donne au script plus de sécurité de type.</span><span class="sxs-lookup"><span data-stu-id="837c7-117">This gives the script more type safety.</span></span> <span data-ttu-id="837c7-118">Vous pouvez voir un exemple de cela dans [Using fetch from Office Scripts](../resources/samples/external-fetch-calls.md).</span><span class="sxs-lookup"><span data-stu-id="837c7-118">You can see an example of this in [Using fetch from Office Scripts](../resources/samples/external-fetch-calls.md).</span></span>

### <a name="limitations-with-external-calls-from-office-scripts"></a><span data-ttu-id="837c7-119">Limitations avec les appels externes de Office Scripts</span><span class="sxs-lookup"><span data-stu-id="837c7-119">Limitations with external calls from Office Scripts</span></span>

* <span data-ttu-id="837c7-120">Il n’y a aucun moyen de se connecter ou d’utiliser le type de flux d’authentification OAuth2.</span><span class="sxs-lookup"><span data-stu-id="837c7-120">There is no way to sign in or use OAuth2 type of authentication flows.</span></span> <span data-ttu-id="837c7-121">Toutes les clés et informations d’identification doivent être codées en dur (ou lues à partir d’une autre source).</span><span class="sxs-lookup"><span data-stu-id="837c7-121">All keys and credentials have to be hardcoded (or read from another source).</span></span>
* <span data-ttu-id="837c7-122">Il n’existe pas d’infrastructure pour stocker les informations d’identification et les clés de l’API.</span><span class="sxs-lookup"><span data-stu-id="837c7-122">There is no infrastructure to store API credentials and keys.</span></span> <span data-ttu-id="837c7-123">Cela devra être géré par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="837c7-123">This will have to be managed by the user.</span></span>
* <span data-ttu-id="837c7-124">Documentez les cookies et `localStorage` les objets ne sont pas pris en `sessionStorage` charge.</span><span class="sxs-lookup"><span data-stu-id="837c7-124">Document cookies, `localStorage`, and `sessionStorage` objects are not supported.</span></span> 
* <span data-ttu-id="837c7-125">Les appels externes peuvent entraîner l’exposition de données sensibles à des paramètres indésirables ou l’entrée de données externes dans des cahiers de travail internes.</span><span class="sxs-lookup"><span data-stu-id="837c7-125">External calls may result in sensitive data being exposed to undesirable endpoints, or external data to be brought into internal workbooks.</span></span> <span data-ttu-id="837c7-126">Votre administrateur peut établir une protection pare-feu contre de tels appels.</span><span class="sxs-lookup"><span data-stu-id="837c7-126">Your admin can establish firewall protection against such calls.</span></span> <span data-ttu-id="837c7-127">Assurez-vous de vérifier auprès des politiques locales avant de vous fier aux appels externes.</span><span class="sxs-lookup"><span data-stu-id="837c7-127">Be sure to check with local policies prior to relying on external calls.</span></span>
* <span data-ttu-id="837c7-128">Assurez-vous de vérifier la quantité de débit de données avant de prendre une dépendance.</span><span class="sxs-lookup"><span data-stu-id="837c7-128">Be sure to check the amount of data throughput prior to taking a dependency.</span></span> <span data-ttu-id="837c7-129">Par exemple, tirer vers le bas l’ensemble de données externes peut ne pas être la meilleure option et au lieu de pagination devrait être utilisé pour obtenir des données en morceaux.</span><span class="sxs-lookup"><span data-stu-id="837c7-129">For instance, pulling down the entire external dataset may not be the best option and instead pagination should be used to get data in chunks.</span></span>

## <a name="retrieve-information-with-fetch"></a><span data-ttu-id="837c7-130">Récupérer des informations avec `fetch`</span><span class="sxs-lookup"><span data-stu-id="837c7-130">Retrieve information with `fetch`</span></span>

<span data-ttu-id="837c7-131">[L’API fetch](https://developer.mozilla.org/docs/Web/API/Fetch_API) récupère des informations auprès de services externes.</span><span class="sxs-lookup"><span data-stu-id="837c7-131">The [fetch API](https://developer.mozilla.org/docs/Web/API/Fetch_API) retrieves information from external services.</span></span> <span data-ttu-id="837c7-132">Il s’agit `async` d’une API, vous devez donc ajuster `main` la signature de votre script.</span><span class="sxs-lookup"><span data-stu-id="837c7-132">It is an `async` API, so you need to adjust the `main` signature of your script.</span></span> <span data-ttu-id="837c7-133">Faire la `main` fonction et lui faire retourner un `async` `Promise<void>` .</span><span class="sxs-lookup"><span data-stu-id="837c7-133">Make the `main` function `async` and have it return a `Promise<void>`.</span></span> <span data-ttu-id="837c7-134">Vous devez également être sûr de `await` `fetch` `json` l’appel et de la récupération.</span><span class="sxs-lookup"><span data-stu-id="837c7-134">You should also be sure to `await` the `fetch` call and `json` retrieval.</span></span> <span data-ttu-id="837c7-135">Cela garantit que ces opérations sont terminées avant la fin du script.</span><span class="sxs-lookup"><span data-stu-id="837c7-135">This ensures those operations complete before the script ends.</span></span>

<span data-ttu-id="837c7-136">Toutes les données JSON récupérées par `fetch` doit correspondre à une interface définie dans le script.</span><span class="sxs-lookup"><span data-stu-id="837c7-136">Any JSON data retrieved by `fetch` must match an interface defined in the script.</span></span> <span data-ttu-id="837c7-137">La valeur retournée doit être attribuée à un type spécifique car [Office scripts ne supportent pas le `any` type](typescript-restrictions.md#no-any-type-in-office-scripts).</span><span class="sxs-lookup"><span data-stu-id="837c7-137">The returned value must be assigned to a specific type because [Office Scripts do not support the `any` type](typescript-restrictions.md#no-any-type-in-office-scripts).</span></span> <span data-ttu-id="837c7-138">Vous devez vous référer à la documentation de votre service pour voir quels sont les noms et les types de propriétés retournées.</span><span class="sxs-lookup"><span data-stu-id="837c7-138">You should refer to the documentation for your service to see what the names and types of the returned properties are.</span></span> <span data-ttu-id="837c7-139">Ensuite, ajoutez l’interface ou les interfaces correspondantes à votre script.</span><span class="sxs-lookup"><span data-stu-id="837c7-139">Then, add the matching interface or interfaces to your script.</span></span>

<span data-ttu-id="837c7-140">Le script suivant utilise `fetch` pour récupérer les données JSON du serveur de test dans l’URL donnée.</span><span class="sxs-lookup"><span data-stu-id="837c7-140">The following script uses `fetch` to retrieve JSON data from the test server in the given URL.</span></span> <span data-ttu-id="837c7-141">Notez `JSONData` l’interface pour stocker les données comme un type correspondant.</span><span class="sxs-lookup"><span data-stu-id="837c7-141">Note the `JSONData` interface to store the data as a matching type.</span></span>

```TypeScript
async function main(workbook: ExcelScript.Workbook): Promise<void> {
  // Retrieve sample JSON data from a test server.
  let fetchResult = await fetch('https://jsonplaceholder.typicode.com/todos/1');

  // Convert the returned data to the expected JSON structure.
  let json : JSONData = await fetchResult.json();

  // Display the content in a readable format.
  console.log(JSON.stringify(json));
}

/**
 * An interface that matches the returned JSON structure.
 * The property names match exactly.
 */
interface JSONData {
  userId: number;
  id: number;
  title: string;
  completed: boolean;
}
```

### <a name="other-fetch-samples"></a><span data-ttu-id="837c7-142">Autres `fetch` échantillons</span><span class="sxs-lookup"><span data-stu-id="837c7-142">Other `fetch` samples</span></span>

* <span data-ttu-id="837c7-143">[L’exemple Utiliser des appels externes d’extraction Office scripts](../resources/samples/external-fetch-calls.md) montre comment obtenir des informations de base sur les référentiels de GitHub utilisateur.</span><span class="sxs-lookup"><span data-stu-id="837c7-143">The [Use external fetch calls in Office Scripts](../resources/samples/external-fetch-calls.md) sample shows how to get basic information about a user's GitHub repositories.</span></span>
* <span data-ttu-id="837c7-144">Le [scénario de l’exemple Office Scripts : Graph données au niveau de l’eau de la NOAA démontrent](../resources/scenarios/noaa-data-fetch.md) que la commande d’extraction est utilisée pour récupérer les enregistrements de la base de données Tides and Currents de la National Oceanic and Atmospheric Administration.</span><span class="sxs-lookup"><span data-stu-id="837c7-144">The [Office Scripts sample scenario: Graph water-level data from NOAA](../resources/scenarios/noaa-data-fetch.md) demonstrates the fetch command being used to retrieve records from the National Oceanic and Atmospheric Administration's Tides and Currents database.</span></span>

## <a name="external-calls-from-power-automate"></a><span data-ttu-id="837c7-145">Appels externes de Power Automate</span><span class="sxs-lookup"><span data-stu-id="837c7-145">External calls from Power Automate</span></span>

<span data-ttu-id="837c7-146">Tout appel API externe échoue lorsqu’un script est exécuté avec Power Automate.</span><span class="sxs-lookup"><span data-stu-id="837c7-146">Any external API call fails when a script is run with Power Automate.</span></span> <span data-ttu-id="837c7-147">Il s’agit d’une différence comportementale entre l’exécution d’un script à travers Excel’application et à travers Power Automate.</span><span class="sxs-lookup"><span data-stu-id="837c7-147">This is a behavioral difference between running a script through the Excel application and through Power Automate.</span></span> <span data-ttu-id="837c7-148">Assurez-vous de vérifier vos scripts pour de telles références avant de les construire dans un flux.</span><span class="sxs-lookup"><span data-stu-id="837c7-148">Be sure to check your scripts for such references before building them into a flow.</span></span>

<span data-ttu-id="837c7-149">Vous devrez utiliser HTTP avec [Azure AD ou d’autres](/connectors/webcontents/) actions équivalentes pour extraire des données ou les pousser vers un service externe.</span><span class="sxs-lookup"><span data-stu-id="837c7-149">You'll have to use [HTTP with Azure AD](/connectors/webcontents/) or other equivalent actions to pull data from or push it to an external service.</span></span>

> [!WARNING]
> <span data-ttu-id="837c7-150">Les appels externes effectués par l’intermédiaire Power Automate [Excel connecteur en ligne](/connectors/excelonlinebusiness) échouent afin d’aider à maintenir les politiques existantes de prévention des pertes de données.</span><span class="sxs-lookup"><span data-stu-id="837c7-150">External calls made through the Power Automate [Excel Online connector](/connectors/excelonlinebusiness) fail in order to help uphold existing data loss prevention policies.</span></span> <span data-ttu-id="837c7-151">Toutefois, les scripts qui sont exécutés à travers Power Automate sont effectués en dehors de votre organisation, et en dehors des pare-feu de votre organisation.</span><span class="sxs-lookup"><span data-stu-id="837c7-151">However, scripts that are run through Power Automate are done so outside of your organization, and outside of your organization's firewalls.</span></span> <span data-ttu-id="837c7-152">Pour une protection supplémentaire contre les utilisateurs malveillants dans cet environnement externe, votre administrateur peut contrôler l’utilisation Office scripts.</span><span class="sxs-lookup"><span data-stu-id="837c7-152">For additional protection from malicious users in this external environment, your admin can control the use of Office Scripts.</span></span> <span data-ttu-id="837c7-153">Votre administrateur peut désactiver le connecteur Excel En ligne en Power Automate ou désactiver les scripts Office pour Excel sur le Web à travers [les contrôles d’administrateur Office Scripts](/microsoft-365/admin/manage/manage-office-scripts-settings).</span><span class="sxs-lookup"><span data-stu-id="837c7-153">Your admin can either disable the Excel Online connector in Power Automate or turn off Office Scripts for Excel on the web through the [Office Scripts administrator controls](/microsoft-365/admin/manage/manage-office-scripts-settings).</span></span>

## <a name="see-also"></a><span data-ttu-id="837c7-154">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="837c7-154">See also</span></span>

* [<span data-ttu-id="837c7-155">Utilisation d’objets JavaScript intégrés dans les scripts Office</span><span class="sxs-lookup"><span data-stu-id="837c7-155">Using built-in JavaScript objects in Office Scripts</span></span>](javascript-objects.md)
* [<span data-ttu-id="837c7-156">Utiliser les appels externes de récupération à Office Scripts</span><span class="sxs-lookup"><span data-stu-id="837c7-156">Use external fetch calls in Office Scripts</span></span>](../resources/samples/external-fetch-calls.md)
* [<span data-ttu-id="837c7-157">Office Scénario de l’échantillon scripts : Graph données sur le niveau de l’eau de la NOAA</span><span class="sxs-lookup"><span data-stu-id="837c7-157">Office Scripts sample scenario: Graph water-level data from NOAA</span></span>](../resources/scenarios/noaa-data-fetch.md)
